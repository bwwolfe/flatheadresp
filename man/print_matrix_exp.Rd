% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/colour_cycle_summary.R
\name{print_matrix_exp}
\alias{print_matrix_exp}
\title{Pretty-print a matrix with colour-mapped values, flags, and a legend}
\usage{
print_matrix_exp(
  x,
  r2_mat = NULL,
  missing_mat = NULL,
  r2_threshold = 0.95,
  digits = 2,
  pad = 1,
  palette = c("#F49898", "#EF6F6C", "#D92523", "#C90202"),
  na_string = "NA ",
  show_border = TRUE,
  legend = TRUE,
  legend_cols = 48,
  missing_label = "missing pO2s",
  show_flag_counts = TRUE,
  extra_col = NULL,
  extra_col_label = NULL
)
}
\arguments{
\item{x}{Numeric matrix. Values to print (NAs allowed).}

\item{r2_mat}{Optional numeric matrix (or vector) of \eqn{R^2} values with the same dimensions as \code{x}.
Converted to a logical mask where \eqn{R^2 <} \code{r2_threshold}.}

\item{missing_mat}{Optional logical/numeric matrix (or vector) with the same dimensions as \code{x}.
Non-zero (or \code{TRUE}) entries mark cells for styling.}

\item{r2_threshold}{Numeric. Threshold for \eqn{R^2} flagging (default \code{0.95}).}

\item{digits}{Integer. Decimal places to print (default \code{2}).}

\item{pad}{Integer. Left padding spaces per cell (default \code{1}).}

\item{palette}{Character vector of hex colours for the gradient (low \eqn{\rightarrow} high),
used when 256/truecolor is available. Default:
\code{c("#F49898", "#EF6F6C", "#D92523", "#C90202")}.}

\item{na_string}{Character. Representation for \code{NA} cells (default \code{"NA "}).}

\item{show_border}{Logical. Draw a vertical separator after the row label (default \code{TRUE}).}

\item{legend}{Logical. Print a legend below the matrix (default \code{TRUE}).}

\item{legend_cols}{Integer. Number of blocks in the legend colour bar (default \code{48}).}

\item{missing_label}{Character. Label for the missing flag in the legend (default \code{"missing pO2s"}).}

\item{show_flag_counts}{Logical. Include counts of flagged cells in the legend (default \code{TRUE}).}

\item{extra_col}{Vector with length equal to \code{nrow(x)}. When supplied, an extra column is printed
to the right of the matrix, one entry per row.}

\item{extra_col_label}{Character. Optional header label for \code{extra_col}. If provided, it appears
in the header row aligned with the extra column.}
}
\value{
Invisibly returns \code{NULL}.
}
\description{
Prints a numeric matrix to the console with row/column labels, padded spacing,
and per-cell colour based on value magnitude (scaled min \eqn{\rightarrow} max).
Two optional flag matrices can add CLI styles to each value:
\itemize{
\item \code{r2_mat}: numeric \eqn{R^2} values converted internally to a binary mask using \code{r2_threshold}.
\item \code{missing_mat}: logical/numeric mask for missing \eqn{O_2} values.
}
}
\details{
This version:
\itemize{
\item Ensures all values are mapped to a visible colour even on low-colour consoles.
\item Handles \eqn{R^2} thresholding internally and auto-generates the legend label.
\item In high-colour mode (\eqn{\ge 256} colours), applies a dark base background with value-dependent colour.
\item Supports an optional extra column printed at the end of each row.
}

\strong{Colour and styling:}

The function uses the \code{cli} package for ANSI styling. Colour strategy adapts to the terminal:
\itemize{
\item \strong{High-colour mode} (\eqn{\ge 256} colours):
\itemize{
\item Values are mapped via a Lab-space gradient built from \code{palette}.
\item A dark base background (\code{"#121212"}) is applied behind value cells for consistent contrast.
\item Missing-flag style: white background with black text.
\item \eqn{R^2}-flag style: bold and underline and italic with green text.
\item Both flags: combined styles including a dark green accent.
\item \code{NA} cells: bright yellow background with blurred blue text.
}
\item \strong{Low-colour mode} (< 256 colours):
\itemize{
\item Value scaling is disabled; all numeric cells use black background with white text.
\item \eqn{R^2}-flagged cells: blue background with white text.
\item Missing-flagged cells: yellow background with black text.
\item Both flags: magenta background with white text.
\item \code{NA} cells: red background with blue text.
}
}

To ensure full colour support when auto-detection is uncertain, you can set:
\preformatted{
options(cli.default_num_colors = 256L)
}

\strong{Flagging:}
\itemize{
\item \code{r2_mat} (matrix or vector) is validated to match \code{x}. It is converted into a binary mask
where \eqn{R^2 <} \code{r2_threshold} and \code{!is.na(r2_mat)}.
\item \code{missing_mat} is coerced into a logical mask of the same dimensions as \code{x}; non-zero/\code{TRUE}
entries mark cells for the missing style.
}

\strong{Extra column:}
\itemize{
\item If \code{extra_col} is supplied, a right-hand column is printed per row.
\item If \code{extra_col_label} is supplied, a header label is printed above that column.
}

\strong{Input validation:}
\itemize{
\item \code{x} must be a numeric matrix; otherwise, the function stops with an error.
\item \code{r2_mat} and \code{missing_mat} (if provided as vectors) are reshaped to match \code{nrow(x)} \eqn{\times} \code{ncol(x)}.
\item Dimension names of \code{x} are propagated to internal masks when present.
}
}
\examples{
set.seed(12)
x <- matrix(runif(20, 0, 1), nrow = 5,
            dimnames = list(paste0("row", 1:5), paste0("col", 1:4)))
r2 <- matrix(runif(20, 0.90, 1.0), nrow = 5)   # mostly high R^2
miss <- matrix(sample(c(FALSE, TRUE), 20, replace = TRUE, prob = c(0.85, 0.15)), nrow = 5)

print_matrix_exp(
  x,
  r2_mat = r2,
  missing_mat = miss,
  digits = 2,
  pad = 1
)
}
